apiVersion: apiextensions.k8s.io/v1beta1
kind: CustomResourceDefinition
metadata:
  name: pipelinedeployments.algo.run
spec:
  group: algo.run
  names:
    kind: PipelineDeployment
    listKind: PipelineDeploymentList
    plural: pipelinedeployments
    singular: pipelinedeployment
  scope: Namespaced
  validation:
    openAPIV3Schema:
      description: PipelineDeployment is the Schema for the PipelineDeployments API
      properties:
        apiVersion:
          description: 'APIVersion defines the versioned schema of this representation
            of an object. Servers should convert recognized schemas to the latest
            internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
          type: string
        kind:
          description: 'Kind is a string value representing the REST resource this
            object represents. Servers may infer this from the endpoint the client
            submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
          type: string
        metadata:
          type: object
        spec:
          description: PipelineDeploymentSpec defines the desired state of the PipelineDeployment
          properties:
            imagePullPolicy:
              type: string
            kafkaBrokers:
              type: string
            pipelineSpec:
              properties:
                algoConfigs:
                  items:
                    properties:
                      algoIndex:
                        format: int32
                        type: integer
                      algoName:
                        type: string
                      algoOwnerUserName:
                        type: string
                      algoParams:
                        items:
                          properties:
                            dataType:
                              properties:
                                mask:
                                  type: string
                                name:
                                  type: string
                                precision:
                                  format: int32
                                  type: integer
                                regex:
                                  type: string
                                scale:
                                  format: int32
                                  type: integer
                              required:
                              - name
                              type: object
                            description:
                              type: string
                            name:
                              type: string
                            options:
                              items:
                                properties:
                                  name:
                                    type: string
                                type: object
                              type: array
                            sortOrder:
                              format: int32
                              type: integer
                            value:
                              type: string
                          required:
                          - name
                          type: object
                        type: array
                      algoRunnerImage:
                        type: string
                      algoRunnerImageTag:
                        type: string
                      algoVersionTag:
                        type: string
                      applied:
                        type: boolean
                      deploymentName:
                        type: string
                      entrypoint:
                        type: string
                      executor:
                        type: string
                      gpuEnabled:
                        type: boolean
                      imageRepository:
                        type: string
                      imageTag:
                        type: string
                      inputs:
                        items:
                          properties:
                            contentTypes:
                              items:
                                properties:
                                  encoding:
                                    type: string
                                  fileExtension:
                                    type: string
                                  groupName:
                                    type: string
                                  iconClass:
                                    type: string
                                  name:
                                    type: string
                                  rfc:
                                    type: string
                                  rfcUrl:
                                    type: string
                                  subTypeName:
                                    type: string
                                  title:
                                    type: string
                                  url:
                                    type: string
                                type: object
                              type: array
                            description:
                              type: string
                            environmentVariable:
                              type: string
                            httpHeaders:
                              type: string
                            httpPath:
                              type: string
                            httpPort:
                              format: int32
                              type: integer
                            httpVerb:
                              type: string
                            inputDeliveryType:
                              type: string
                            isRequired:
                              type: boolean
                            name:
                              type: string
                            parameter:
                              type: string
                            parameterDelimiter:
                              type: string
                          required:
                          - contentTypes
                          - inputDeliveryType
                          - name
                          type: object
                        type: array
                      livenessInitialDelaySeconds:
                        format: int32
                        type: integer
                      livenessPeriodSeconds:
                        format: int32
                        type: integer
                      livenessTimeoutSeconds:
                        format: int32
                        type: integer
                      outputs:
                        items:
                          properties:
                            contentType:
                              properties:
                                encoding:
                                  type: string
                                fileExtension:
                                  type: string
                                groupName:
                                  type: string
                                iconClass:
                                  type: string
                                name:
                                  type: string
                                rfc:
                                  type: string
                                rfcUrl:
                                  type: string
                                subTypeName:
                                  type: string
                                title:
                                  type: string
                                url:
                                  type: string
                              type: object
                            description:
                              type: string
                            name:
                              type: string
                            outputDeliveryType:
                              type: string
                            parameter:
                              type: string
                          required:
                          - contentType
                          - name
                          - outputDeliveryType
                          type: object
                        type: array
                      readinessInitialDelaySeconds:
                        format: int32
                        type: integer
                      readinessPeriodSeconds:
                        format: int32
                        type: integer
                      readinessTimeoutSeconds:
                        format: int32
                        type: integer
                      resource:
                        properties:
                          autoScale:
                            type: boolean
                          cpuLimitMillicores:
                            format: int64
                            type: integer
                          cpuRequestMillicores:
                            format: int64
                            type: integer
                          gpuLimitMillicores:
                            format: int64
                            type: integer
                          instances:
                            format: int32
                            type: integer
                          maxInstances:
                            format: int32
                            type: integer
                          memoryLimitBytes:
                            format: int64
                            type: integer
                          memoryRequestBytes:
                            format: int64
                            type: integer
                          minInstances:
                            format: int32
                            type: integer
                          scaleMetrics:
                            items:
                              properties:
                                averageUtilization:
                                  format: int32
                                  type: integer
                                averageValue:
                                  type: string
                                metricName:
                                  type: string
                                metricSelector:
                                  type: string
                                objectApiVersion:
                                  type: string
                                objectKind:
                                  type: string
                                objectName:
                                  type: string
                                resourceName:
                                  type: string
                                sourceType:
                                  type: string
                                targetType:
                                  type: string
                                value:
                                  type: string
                              type: object
                            type: array
                        type: object
                      timeoutSeconds:
                        format: int32
                        type: integer
                      writeAllOutputs:
                        type: boolean
                    type: object
                  type: array
                dataConnectorConfigs:
                  items:
                    properties:
                      connectorClass:
                        type: string
                      dataConnectorType:
                        type: string
                      deploymentName:
                        type: string
                      imageRepository:
                        type: string
                      imageTag:
                        type: string
                      index:
                        format: int32
                        type: integer
                      name:
                        type: string
                      options:
                        items:
                          properties:
                            dataType:
                              properties:
                                mask:
                                  type: string
                                name:
                                  type: string
                                precision:
                                  format: int32
                                  type: integer
                                regex:
                                  type: string
                                scale:
                                  format: int32
                                  type: integer
                              required:
                              - name
                              type: object
                            description:
                              type: string
                            name:
                              type: string
                            required:
                              type: boolean
                            sortOrder:
                              format: int32
                              type: integer
                            value:
                              type: string
                          type: object
                        type: array
                      tasksMax:
                        format: int32
                        type: integer
                      versionTag:
                        type: string
                    type: object
                  type: array
                deploymentName:
                  type: string
                deploymentOwnerUserName:
                  type: string
                endpointConfig:
                  properties:
                    deploymentName:
                      type: string
                    deploymentOwnerUserName:
                      type: string
                    imageRepository:
                      type: string
                    imageTag:
                      type: string
                    kafka:
                      properties:
                        brokers:
                          items:
                            type: string
                          type: array
                        params:
                          additionalProperties:
                            type: string
                          type: object
                      type: object
                    paths:
                      items:
                        properties:
                          connectionString:
                            type: string
                          contentType:
                            properties:
                              encoding:
                                type: string
                              fileExtension:
                                type: string
                              groupName:
                                type: string
                              iconClass:
                                type: string
                              name:
                                type: string
                              rfc:
                                type: string
                              rfcUrl:
                                type: string
                              subTypeName:
                                type: string
                              title:
                                type: string
                              url:
                                type: string
                            type: object
                          description:
                            type: string
                          endpointType:
                            type: string
                          isDefault:
                            type: boolean
                          messageDataType:
                            type: string
                          name:
                            type: string
                        type: object
                      type: array
                    pipelineName:
                      type: string
                    pipelineOwnerUserName:
                      type: string
                    producer:
                      properties:
                        cb:
                          properties:
                            fails:
                              format: int32
                              type: integer
                            interval:
                              format: int32
                              type: integer
                            requests:
                              format: int32
                              type: integer
                            timeout:
                              type: string
                          type: object
                        resend:
                          properties:
                            period:
                              type: string
                            rate_limit:
                              format: int32
                              type: integer
                          type: object
                        wal:
                          properties:
                            always_topics:
                              items:
                                type: string
                              type: array
                            disable_topics:
                              items:
                                type: string
                              type: array
                            mode:
                              type: string
                            path:
                              type: string
                            size:
                              type: string
                          type: object
                      type: object
                    resource:
                      properties:
                        autoScale:
                          type: boolean
                        cpuLimitMillicores:
                          format: int64
                          type: integer
                        cpuRequestMillicores:
                          format: int64
                          type: integer
                        gpuLimitMillicores:
                          format: int64
                          type: integer
                        instances:
                          format: int32
                          type: integer
                        maxInstances:
                          format: int32
                          type: integer
                        memoryLimitBytes:
                          format: int64
                          type: integer
                        memoryRequestBytes:
                          format: int64
                          type: integer
                        minInstances:
                          format: int32
                          type: integer
                        scaleMetrics:
                          items:
                            properties:
                              averageUtilization:
                                format: int32
                                type: integer
                              averageValue:
                                type: string
                              metricName:
                                type: string
                              metricSelector:
                                type: string
                              objectApiVersion:
                                type: string
                              objectKind:
                                type: string
                              objectName:
                                type: string
                              resourceName:
                                type: string
                              sourceType:
                                type: string
                              targetType:
                                type: string
                              value:
                                type: string
                            type: object
                          type: array
                      type: object
                    server:
                      properties:
                        grpc:
                          properties:
                            listen:
                              type: string
                          type: object
                        http:
                          properties:
                            listen:
                              type: string
                          type: object
                        monitoring:
                          properties:
                            listen:
                              type: string
                          type: object
                      type: object
                  type: object
                hookConfig:
                  properties:
                    deploymentName:
                      type: string
                    deploymentOwnerUserName:
                      type: string
                    imageRepository:
                      type: string
                    imageTag:
                      type: string
                    pipelineName:
                      type: string
                    pipelineOwnerUserName:
                      type: string
                    pipes:
                      items:
                        properties:
                          destComponentType:
                            type: string
                          destInputName:
                            type: string
                          destName:
                            type: string
                          sourceComponentType:
                            type: string
                          sourceName:
                            type: string
                          sourceOutputMessageDataType:
                            type: string
                          sourceOutputName:
                            type: string
                        type: object
                      type: array
                    resource:
                      properties:
                        autoScale:
                          type: boolean
                        cpuLimitMillicores:
                          format: int64
                          type: integer
                        cpuRequestMillicores:
                          format: int64
                          type: integer
                        gpuLimitMillicores:
                          format: int64
                          type: integer
                        instances:
                          format: int32
                          type: integer
                        maxInstances:
                          format: int32
                          type: integer
                        memoryLimitBytes:
                          format: int64
                          type: integer
                        memoryRequestBytes:
                          format: int64
                          type: integer
                        minInstances:
                          format: int32
                          type: integer
                        scaleMetrics:
                          items:
                            properties:
                              averageUtilization:
                                format: int32
                                type: integer
                              averageValue:
                                type: string
                              metricName:
                                type: string
                              metricSelector:
                                type: string
                              objectApiVersion:
                                type: string
                              objectKind:
                                type: string
                              objectName:
                                type: string
                              resourceName:
                                type: string
                              sourceType:
                                type: string
                              targetType:
                                type: string
                              value:
                                type: string
                            type: object
                          type: array
                      type: object
                    topicConfigs:
                      items:
                        properties:
                          componentType:
                            type: string
                          sourceName:
                            type: string
                          sourceOutputName:
                            type: string
                          topicAutoName:
                            type: boolean
                          topicAutoPartition:
                            type: boolean
                          topicName:
                            type: string
                          topicParams:
                            items:
                              properties:
                                name:
                                  type: string
                                value:
                                  type: string
                              type: object
                            type: array
                          topicPartitions:
                            format: int32
                            type: integer
                          topicReplicationFactor:
                            format: int32
                            type: integer
                        type: object
                      type: array
                    webHooks:
                      items:
                        properties:
                          deploymentName:
                            type: string
                          deploymentOwnerUserName:
                            type: string
                          httpHeaders:
                            type: string
                          httpVerb:
                            type: string
                          pipelineHookInputName:
                            type: string
                          webHookUrl:
                            type: string
                        type: object
                      type: array
                  type: object
                pipelineName:
                  type: string
                pipelineOwnerUserName:
                  type: string
                pipelineVersionTag:
                  type: string
                pipes:
                  items:
                    properties:
                      destComponentType:
                        type: string
                      destInputName:
                        type: string
                      destName:
                        type: string
                      sourceComponentType:
                        type: string
                      sourceName:
                        type: string
                      sourceOutputMessageDataType:
                        type: string
                      sourceOutputName:
                        type: string
                    type: object
                  type: array
                storageBucket:
                  type: string
                topicConfigs:
                  items:
                    properties:
                      componentType:
                        type: string
                      sourceName:
                        type: string
                      sourceOutputName:
                        type: string
                      topicAutoName:
                        type: boolean
                      topicAutoPartition:
                        type: boolean
                      topicName:
                        type: string
                      topicParams:
                        items:
                          properties:
                            name:
                              type: string
                            value:
                              type: string
                          type: object
                        type: array
                      topicPartitions:
                        format: int32
                        type: integer
                      topicReplicationFactor:
                        format: int32
                        type: integer
                    type: object
                  type: array
              type: object
          type: object
        status:
          description: PipelineDeploymentStatus defines the observed state of PipelineDeployment
          properties:
            componentStatuses:
              items:
                properties:
                  available:
                    format: int32
                    type: integer
                  componentType:
                    type: string
                  createdTimestamp:
                    type: string
                  current:
                    format: int32
                    type: integer
                  deploymentName:
                    type: string
                  desired:
                    format: int32
                    type: integer
                  index:
                    format: int32
                    type: integer
                  name:
                    type: string
                  ready:
                    format: int32
                    type: integer
                  status:
                    type: string
                  upToDate:
                    format: int32
                    type: integer
                  versionTag:
                    type: string
                type: object
              type: array
            deploymentName:
              type: string
            deploymentOwnerUserName:
              type: string
            podStatuses:
              items:
                properties:
                  componentType:
                    type: string
                  containerStatuses:
                    items:
                      description: ContainerStatus contains details for the current
                        status of this container.
                      properties:
                        containerID:
                          description: Container's ID in the format 'docker://<container_id>'.
                          type: string
                        image:
                          description: 'The image the container is running. More info:
                            https://kubernetes.io/docs/concepts/containers/images
                            TODO(dchen1107): Which image the container is running
                            with?'
                          type: string
                        imageID:
                          description: ImageID of the container's image.
                          type: string
                        lastState:
                          description: Details about the container's last termination
                            condition.
                          properties:
                            running:
                              description: Details about a running container
                              properties:
                                startedAt:
                                  description: Time at which the container was last
                                    (re-)started
                                  format: date-time
                                  type: string
                              type: object
                            terminated:
                              description: Details about a terminated container
                              properties:
                                containerID:
                                  description: Container's ID in the format 'docker://<container_id>'
                                  type: string
                                exitCode:
                                  description: Exit status from the last termination
                                    of the container
                                  format: int32
                                  type: integer
                                finishedAt:
                                  description: Time at which the container last terminated
                                  format: date-time
                                  type: string
                                message:
                                  description: Message regarding the last termination
                                    of the container
                                  type: string
                                reason:
                                  description: (brief) reason from the last termination
                                    of the container
                                  type: string
                                signal:
                                  description: Signal from the last termination of
                                    the container
                                  format: int32
                                  type: integer
                                startedAt:
                                  description: Time at which previous execution of
                                    the container started
                                  format: date-time
                                  type: string
                              required:
                              - exitCode
                              type: object
                            waiting:
                              description: Details about a waiting container
                              properties:
                                message:
                                  description: Message regarding why the container
                                    is not yet running.
                                  type: string
                                reason:
                                  description: (brief) reason the container is not
                                    yet running.
                                  type: string
                              type: object
                          type: object
                        name:
                          description: This must be a DNS_LABEL. Each container in
                            a pod must have a unique name. Cannot be updated.
                          type: string
                        ready:
                          description: Specifies whether the container has passed
                            its readiness probe.
                          type: boolean
                        restartCount:
                          description: The number of times the container has been
                            restarted, currently based on the number of dead containers
                            that have not yet been removed. Note that this is calculated
                            from dead containers. But those containers are subject
                            to garbage collection. This value will get capped at 5
                            by GC.
                          format: int32
                          type: integer
                        started:
                          description: Specifies whether the container has passed
                            its startup probe. Initialized as false, becomes true
                            after startupProbe is considered successful. Resets to
                            false when the container is restarted, or if kubelet loses
                            state temporarily. Is always true when no startupProbe
                            is defined.
                          type: boolean
                        state:
                          description: Details about the container's current condition.
                          properties:
                            running:
                              description: Details about a running container
                              properties:
                                startedAt:
                                  description: Time at which the container was last
                                    (re-)started
                                  format: date-time
                                  type: string
                              type: object
                            terminated:
                              description: Details about a terminated container
                              properties:
                                containerID:
                                  description: Container's ID in the format 'docker://<container_id>'
                                  type: string
                                exitCode:
                                  description: Exit status from the last termination
                                    of the container
                                  format: int32
                                  type: integer
                                finishedAt:
                                  description: Time at which the container last terminated
                                  format: date-time
                                  type: string
                                message:
                                  description: Message regarding the last termination
                                    of the container
                                  type: string
                                reason:
                                  description: (brief) reason from the last termination
                                    of the container
                                  type: string
                                signal:
                                  description: Signal from the last termination of
                                    the container
                                  format: int32
                                  type: integer
                                startedAt:
                                  description: Time at which previous execution of
                                    the container started
                                  format: date-time
                                  type: string
                              required:
                              - exitCode
                              type: object
                            waiting:
                              description: Details about a waiting container
                              properties:
                                message:
                                  description: Message regarding why the container
                                    is not yet running.
                                  type: string
                                reason:
                                  description: (brief) reason the container is not
                                    yet running.
                                  type: string
                              type: object
                          type: object
                      required:
                      - image
                      - imageID
                      - name
                      - ready
                      - restartCount
                      type: object
                    type: array
                  createdTimestamp:
                    type: string
                  index:
                    format: int32
                    type: integer
                  ip:
                    type: string
                  name:
                    type: string
                  node:
                    type: string
                  podName:
                    type: string
                  restarts:
                    format: int32
                    type: integer
                  status:
                    type: string
                  versionTag:
                    type: string
                type: object
              type: array
            status:
              type: string
          type: object
      type: object
  version: v1beta1
  versions:
  - name: v1beta1
    served: true
    storage: true
